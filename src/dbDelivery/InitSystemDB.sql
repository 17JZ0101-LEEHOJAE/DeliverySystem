/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
/**
 * 初期化用 SQL
 * Author:  17jz0101 Lee Ho Jae
 * Created: 2019/02/14
 */

/**
 * VIEWの削除
 */
DROP VIEW CUSTOMER_VIEW;
DROP VIEW ORDERS_VIEW;
DROP VIEW ORDERCSLIP_VIEW;

/**
 * シーケンスの削除
 */
DROP SEQUENCE S_CUSTOMER;
DROP SEQUENCE S_ORDERS;
DROP SEQUENCE S_ORDER_DETAIL;
DROP SEQUENCE S_ORDER_SLIP;

/**
 * テーブルの削除
 */
DROP TABLE CUSTOMER CASCADE CONSTRAINTS;
DROP TABLE ITEM CASCADE CONSTRAINTS;
DROP TABLE ORDERSLIP CASCADE CONSTRAINTS;
DROP TABLE ORDERDETAIL CASCADE CONSTRAINTS;
DROP TABLE ORDERS CASCADE CONSTRAINTS;

/**
 * テーブルの作成
 */
CREATE TABLE CUSTOMER (
    CUSTOMER_ID     NUMBER(4)           NOT NULL,
    NAME            VARCHAR2(20)        NOT NULL,
    TEL             VARCHAR2(12)        NOT NULL,
    ADDRESS         VARCHAR2(30)        NOT NULL,
    POINT           NUMBER(3) DEFAULT 0 NOT NULL   
);
ALTER TABLE CUSTOMER ADD CONSTRAINT PK_CUSTOMER PRIMARY KEY (CUSTOMER_ID);

CREATE TABLE ORDERS (
    ORDER_ID        NUMBER(5)           NOT NULL,
    CUSTOMER_ID     NUMBER(4)           NOT NULL,
    ORDERDATE       DATE                NOT NULL,
    TOTALPRICE      NUMBER(6) DEFAULT 0 NOT NULL,
    DELIVERYDATE    DATE                NOT NULL,
    USEDPOINT       NUMBER(3) DEFAULT 0 NOT NULL
);
ALTER TABLE ORDERS ADD CONSTRAINT PK_ORDERS PRIMARY KEY (ORDER_ID);

ALTER TABLE ORDERS ADD CONSTRAINT FK_ORDERS_0 FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER (CUSTOMER_ID);

CREATE TABLE ITEM (
    ITEM_ID     VARCHAR2(3)     NOT NULL,
    ITEM_NAME   VARCHAR2(30)    NOT NULL,
    ITEM_PRICE  NUMBER(4)
);
ALTER TABLE ITEM ADD CONSTRAINT PK_ITEM PRIMARY KEY (ITEM_ID);

CREATE TABLE ORDERDETAIL (
    ORDERDETAIL_ID  NUMBER(6)            NOT NULL,
    ITEM_ID         VARCHAR2(3)          NOT NULL,
    ORDER_ID        NUMBER(5)            NOT NULL,
    ORDERCOUNT      NUMBER(3) DEFAULT 0,   
    ORDERPRICE      NUMBER(6) DEFAULT 0  
);
ALTER TABLE ORDERDETAIL ADD CONSTRAINT PK_ORDERDETAIL PRIMARY KEY (ORDERDETAIL_ID);

ALTER TABLE ORDERDETAIL ADD CONSTRAINT FK_ORDERDETAIL_1 FOREIGN KEY (ORDER_ID) REFERENCES ORDERS (ORDER_ID);
ALTER TABLE ORDERDETAIL ADD CONSTRAINT FK_ORDERDETAIL_0 FOREIGN KEY (ITEM_ID) REFERENCES ITEM (ITEM_ID);

CREATE TABLE ORDERSLIP (
    ORDER_ID        NUMBER(5)       NOT NULL,
    ORDERSLIP_ID    NUMBER(6)       NOT NULL,
    PAID            NUMBER(1)       NOT NULL
);
ALTER TABLE ORDERSLIP ADD CONSTRAINT PK_ORDERSLIP PRIMARY KEY (ORDER_ID);

ALTER TABLE ORDERSLIP ADD CONSTRAINT FK_ORDERSLIP FOREIGN KEY (ORDER_ID) REFERENCES ORDERS (ORDER_ID);

/**
 * データの挿入
 * CUSTOMER
 */
INSERT INTO CUSTOMER (CUSTOMER_ID, NAME, TEL, ADDRESS, POINT) VALUES (1001, 'イシイ', '07077355541', '東京都百人町1-1-1', 50);
INSERT INTO CUSTOMER (CUSTOMER_ID, NAME, TEL, ADDRESS, POINT) VALUES (1002, 'キムラ', '07062417844', '東京都百人町1-2-1', 25);
INSERT INTO CUSTOMER (CUSTOMER_ID, NAME, TEL, ADDRESS, POINT) VALUES (1003, 'アオキ', '07013206389', '東京都百人町1-3-1', 10);
INSERT INTO CUSTOMER (CUSTOMER_ID, NAME, TEL, ADDRESS, POINT) VALUES (1004, 'エンドウ', '08044322517', '東京都百人町1-4-1', 0);
INSERT INTO CUSTOMER (CUSTOMER_ID, NAME, TEL, ADDRESS, POINT) VALUES (1005, 'カトウ', '08068205238', '東京都百人町1-5-1', 0);

/**
 * データの挿入
 * ITEM
 */
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A01', 'トリピミックス', 2500);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A02', 'ベーコンピザ', 1200);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A03', 'マルゲリータピザ', 1200);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A04', 'オリーブピザ', 1200);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A05', 'アンチョビピザ', 1200);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A06', 'クアトロ・スタジオー二ピザ', 1200);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A07', 'フライドチキン', 1200);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A08', 'しょう油チキン', 1200);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A09', 'チリチキン', 1200);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A10', 'カルビーチキン', 1200);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A11', 'チーズチキン', 1200);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A12', '半々チキン', 1350);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A13', '半々ピザ', 1350);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A14', 'コーラ', 400);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A15', 'スプライト', 400);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A16', '(S)コーラ', 0);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A17', '(S)スプライト', 0);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A18', '(S)トリピミックス', 0);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A19', '(S)ミニチキン', 0);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A20', '(S)ミニピザ', 0);
INSERT INTO ITEM (ITEM_ID, ITEM_NAME, ITEM_PRICE) VALUES ('A21', '10%割引', 0);

/**
 * データの挿入
 * ORDERS
 */
INSERT INTO ORDERS (ORDER_ID, CUSTOMER_ID, ORDERDATE, TOTALPRICE, DELIVERYDATE, USEDPOINT) VALUES (10001, 1001, '2018-11-29', 2500, '2018-11-30', 0);
INSERT INTO ORDERS (ORDER_ID, CUSTOMER_ID, ORDERDATE, TOTALPRICE, DELIVERYDATE, USEDPOINT) VALUES (10002, 1002, '2018-11-29', 2500, '2018-11-30', 0);
INSERT INTO ORDERS (ORDER_ID, CUSTOMER_ID, ORDERDATE, TOTALPRICE, DELIVERYDATE, USEDPOINT) VALUES (10003, 1003, '2018-11-30', 2500, '2018-11-30', 0);
INSERT INTO ORDERS (ORDER_ID, CUSTOMER_ID, ORDERDATE, TOTALPRICE, DELIVERYDATE, USEDPOINT) VALUES (10004, 1003, '2018-12-01', 2500, '2018-12-02', 0);
INSERT INTO ORDERS (ORDER_ID, CUSTOMER_ID, ORDERDATE, TOTALPRICE, DELIVERYDATE, USEDPOINT) VALUES (10005, 1004, '2018-12-02', 2500, '2018-12-03', 0);
INSERT INTO ORDERS (ORDER_ID, CUSTOMER_ID, ORDERDATE, TOTALPRICE, DELIVERYDATE, USEDPOINT) VALUES (10006, 1005, '2018-12-05', 2900, '2018-12-06', 0);
INSERT INTO ORDERS (ORDER_ID, CUSTOMER_ID, ORDERDATE, TOTALPRICE, DELIVERYDATE, USEDPOINT) VALUES (10007, 1004, '2018-12-05', 1600, '2018-12-07', 0);
INSERT INTO ORDERS (ORDER_ID, CUSTOMER_ID, ORDERDATE, TOTALPRICE, DELIVERYDATE, USEDPOINT) VALUES (10008, 1002, '2018-12-06', 1750, '2018-12-06', 0);

/**
 * データの挿入
 * ORDERDETAIL
 */
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (1, 'A01', 10001, 1, 2500);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (2, 'A16', 10001, 1, 0);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (3, 'A01', 10002, 1, 2500);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (4, 'A16', 10002, 1, 0);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (5, 'A01', 10003, 1, 2500);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (6, 'A17', 10003, 1, 0);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (7, 'A01', 10004, 1, 2500);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (8, 'A17', 10004, 1, 0);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (9, 'A01', 10005, 1, 2500);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (10, 'A17', 10005, 1, 0);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (11, 'A01', 10006, 1, 2500);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (12, 'A16', 10006, 1, 0);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (13, 'A15', 10006, 1, 400);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (14, 'A02', 10007, 1, 1200);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (15, 'A15', 10007, 1, 400);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (16, 'A12', 10008, 1, 1350);
INSERT INTO ORDERDETAIL (ORDERDETAIL_ID, ITEM_ID, ORDER_ID, ORDERCOUNT, ORDERPRICE) VALUES (17, 'A14', 10008, 1, 400);

/**
 * データの挿入
 * ORDERSLIP
 */
INSERT INTO ORDERSLIP (ORDER_ID, ORDERSLIP_ID, PAID) VALUES (10001, 100001, 1);
INSERT INTO ORDERSLIP (ORDER_ID, ORDERSLIP_ID, PAID) VALUES (10002, 100002, 1);
INSERT INTO ORDERSLIP (ORDER_ID, ORDERSLIP_ID, PAID) VALUES (10003, 100003, 1);
INSERT INTO ORDERSLIP (ORDER_ID, ORDERSLIP_ID, PAID) VALUES (10004, 100004, 1);
INSERT INTO ORDERSLIP (ORDER_ID, ORDERSLIP_ID, PAID) VALUES (10005, 100005, 1);
INSERT INTO ORDERSLIP (ORDER_ID, ORDERSLIP_ID, PAID) VALUES (10006, 100006, 1);
INSERT INTO ORDERSLIP (ORDER_ID, ORDERSLIP_ID, PAID) VALUES (10007, 100007, 1);
INSERT INTO ORDERSLIP (ORDER_ID, ORDERSLIP_ID, PAID) VALUES (10008, 100008, 1);

/**
 * VIEWの作成
 */
CREATE VIEW CUSTOMER_VIEW AS SELECT c.customer_id, order_id, name, tel, address, point,
orderdate, deliverydate
FROM CUSTOMER c JOIN ORDERS o
ON c.customer_id = o.customer_id
ORDER BY orderdate, deliverydate, name;

CREATE VIEW ORDERS_VIEW AS SELECT name, tel, point, item_name,
orderprice, ordercount,
orderdate, deliverydate, usedpoint,
item_price * ordercount totalprice
FROM CUSTOMER c JOIN ORDERS o
ON c.customer_id = o.customer_id
JOIN ORDERDETAIL od
ON o.order_id = od.order_id
JOIN ITEM i
ON od.item_id = i.item_id
ORDER BY orderdate, name, item_name DESC;

CREATE VIEW ORDERCSLIP_VIEW AS SELECT order_id, item_name, ordercount, orderprice
FROM ORDERDETAIL od JOIN ITEM i
ON od.item_id = i.item_id
ORDER BY order_id;

/**
 * シーケンスの作成
 */
CREATE SEQUENCE S_CUSTOMER
    START WITH 1006
    INCREMENT BY 1
    MAXVALUE 9999
    MINVALUE 1001
    NOCYCLE
;

CREATE SEQUENCE S_ORDERS
    START WITH 10009
    INCREMENT BY 1
    MAXVALUE 99999
    MINVALUE 10001
    NOCYCLE
;

CREATE SEQUENCE S_ORDER_DETAIL
    START WITH 18
    INCREMENT BY 1
    MAXVALUE 999999
    MINVALUE 1
    NOCYCLE
;

CREATE SEQUENCE S_ORDER_SLIP
    START WITH 100009
    INCREMENT BY 1
    MAXVALUE 999999
    MINVALUE 100001
    NOCYCLE
;
